<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDB - Central de Exegese</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --bg: #000000; --card: #161618; --accent: #0A84FF;
            --text: #ffffff; --muted: #8E8E93; --border: #2C2C2E;
            --success: #30D158; --danger: #FF453A;
        }
        
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; }
        header { padding: 20px; border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; text-align: center; }

        /* Navega√ß√£o Inferior */
        nav { position: fixed; bottom: 0; width: 100%; background: var(--card); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; }
        .nav-item { color: var(--muted); text-decoration: none; font-size: 11px; display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: 0.2s; }
        .nav-item.active { color: var(--accent); }
        .nav-item span { font-size: 22px; margin-bottom: 4px; }

        /* P√°ginas */
        .page { display: none; padding: 20px; animation: fadeIn 0.2s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* UI Elements */
        .card { background: var(--card); border-radius: 14px; padding: 18px; margin-bottom: 15px; border: 1px solid var(--border); }
        .badge { background: #323234; padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: bold; margin-bottom: 10px; display: inline-block; text-transform: uppercase; }
        h3 { margin: 0; color: var(--accent); font-size: 1.1rem; }
        
        textarea, input { width: 100%; background: #000; border: 1px solid var(--border); border-radius: 10px; color: #fff; padding: 14px; margin-top: 10px; font-size: 16px; box-sizing: border-box; outline: none; }
        .search-box { background: #1C1C1E; border: none; margin-bottom: 20px; }

        /* Bot√µes de Exporta√ß√£o */
        .export-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn { padding: 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-pdf { background: var(--danger); color: white; }
        .btn-txt { background: #323234; color: white; border: 1px solid #48484a; }
        .btn-save { background: var(--accent); color: white; width: 100%; margin-top: 20px; }

        /* Lista de Hist√≥rico */
        .hist-item { padding: 12px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 14px; }
        .hist-date { color: var(--muted); font-size: 12px; }
    </style>
</head>
<body>

<header id="header-title">Caderno de Estudo</header>

<div id="p-caderno" class="page active">
    <div id="pdf-area">
        <input type="text" id="ref" placeholder="Refer√™ncia (ex: Filipenses 4:13)">
        
        <div class="card" style="border-left: 4px solid var(--accent);">
            <div class="badge">Passo 1</div>
            <h3>Observa√ß√£o üîç</h3>
            <textarea id="obs" rows="4" placeholder="O que o texto diz objetivamente?"></textarea>
        </div>

        <div class="card" style="border-left: 4px solid #F1C40F;">
            <div class="badge">Passo 2</div>
            <h3>Interpreta√ß√£o üí°</h3>
            <textarea id="int" rows="4" placeholder="O que isso significou para o autor e ouvintes originais?"></textarea>
        </div>

        <div class="card" style="border-left: 4px solid #9B59B6;">
            <div class="badge">Apoio</div>
            <h3>Ferramentas üõ†Ô∏è</h3>
            <textarea id="fer" rows="3" placeholder="L√≠nguas originais, l√©xicos e coment√°rios..."></textarea>
        </div>

        <div class="card" style="border-left: 4px solid var(--success);">
            <div class="badge">Passo 3</div>
            <h3>Aplica√ß√£o üå±</h3>
            <textarea id="apl" rows="4" placeholder="Como essa verdade se aplica hoje?"></textarea>
        </div>
    </div>

    <button class="btn btn-save" onclick="salvarNoHistorico()">üíæ Registrar e Liberar Downloads</button>
    
    <div class="export-group">
        <button class="btn btn-pdf" onclick="baixarPDF()">üìÑ Baixar PDF</button>
        <button class="btn btn-txt" onclick="baixarTXT()">üìù Baixar TXT</button>
    </div>
</div>

<div id="p-teoria" class="page">
    <input type="text" id="search" class="search-box" placeholder="üîé Pesquisar na apostila..." onkeyup="filtrarTeoria()">
    <div id="lista-teoria">
        <div class="card t-item">
            <div class="badge">Aula 1</div>
            <h3>Eisegese (O V√≠cio)</h3>
            <p style="font-size: 14px; color: var(--muted);">Ler "para dentro" do texto. Impor seus pr√≥prios pensamentos em vez da inten√ß√£o do autor.</p>
        </div>
        <div class="card t-item">
            <div class="badge">Aula 2</div>
            <h3>Pilar 1: Observa√ß√£o</h3>
            <p style="font-size: 14px; color: var(--muted);">Identifique verbos, repeti√ß√µes e personagens. N√£o interprete ainda, apenas veja o que est√° l√°.</p>
        </div>
        <div class="card t-item">
            <div class="badge">Aula 3</div>
            <h3>Pilar 2: Interpreta√ß√£o</h3>
            <p style="font-size: 14px; color: var(--muted);">Contexto √© rei. O que o autor quis comunicar para aquela audi√™ncia espec√≠fica?</p>
        </div>
    </div>
</div>

<div id="p-check" class="page">
    <h2>Checklist de Estudo</h2>
    <div class="card">
        <label style="display:flex; gap:10px; padding:10px 0; border-bottom:1px solid var(--border);">
            <input type="checkbox"> Orar por ilumina√ß√£o
        </label>
        <label style="display:flex; gap:10px; padding:10px 0; border-bottom:1px solid var(--border);">
            <input type="checkbox"> Ler o contexto (cap√≠tulos antes/depois)
        </label>
        <label style="display:flex; gap:10px; padding:10px 0; border-bottom:1px solid var(--border);">
            <input type="checkbox"> Identificar a inten√ß√£o autoral
        </label>
    </div>
    <button class="btn btn-txt" onclick="limparCaderno()" style="width:100%; border-color:var(--danger); color:var(--danger)">üóëÔ∏è Resetar Estudo</button>
</div>

<div id="p-hist" class="page">
    <h2>Estudos Realizados</h2>
    <div id="lista-hist" class="card"></div>
</div>

<nav>
    <div class="nav-item active" onclick="switchPage('p-caderno', this, 'Caderno de Estudo')"><span>üìù</span>Caderno</div>
    <div class="nav-item" onclick="switchPage('p-teoria', this, 'Biblioteca')"><span>üìö</span>Teoria</div>
    <div class="nav-item" onclick="switchPage('p-check', this, 'Checklist')"><span>‚úÖ</span>Checklist</div>
    <div class="nav-item" onclick="switchPage('p-hist', this, 'Hist√≥rico')"><span>üïí</span>Hist√≥rico</div>
</nav>

<script>
    function switchPage(id, el, title) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
        document.getElementById('header-title').innerText = title;
        window.scrollTo(0,0);
    }

    function filtrarTeoria() {
        let q = document.getElementById('search').value.toLowerCase();
        document.querySelectorAll('.t-item').forEach(i => {
            i.style.display = i.innerText.toLowerCase().includes(q) ? 'block' : 'none';
        });
    }

    function salvarNoHistorico() {
        const ref = document.getElementById('ref').value || 'Estudo';
        let hist = JSON.parse(localStorage.getItem('edb_history') || '[]');
        hist.push({ ref: ref, data: new Date().toLocaleDateString() });
        localStorage.setItem('edb_history', JSON.stringify(hist));
        carregarHistorico();
        alert("Estudo registrado no hist√≥rico! Agora voc√™ pode baixar o PDF ou TXT.");
    }

    function carregarHistorico() {
        const hist = JSON.parse(localStorage.getItem('edb_history') || '[]');
        document.getElementById('lista-hist').innerHTML = hist.map(h => `
            <div class="hist-item">
                <span><b>${h.ref}</b></span>
                <span class="hist-date">${h.data}</span>
            </div>`).reverse().join('') || 'Nenhum estudo salvo.';
    }

    function baixarPDF() {
        const element = document.getElementById('pdf-area');
        const ref = document.getElementById('ref').value || 'estudo';
        const opt = { 
            margin: 10, filename: `EDB_${ref}.pdf`, 
            html2canvas: { scale: 2, backgroundColor: '#161618' },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } 
        };
        html2pdf().set(opt).from(element).save();
    }

    function baixarTXT() {
        const ref = document.getElementById('ref').value || 'estudo';
        const conteudo = `
ESTUDO B√çBLICO - EDB
Refer√™ncia: ${ref}
-----------------------------
1. OBSERVA√á√ÉO:
${document.getElementById('obs').value}

2. INTERPRETA√á√ÉO:
${document.getElementById('int').value}

3. FERRAMENTAS:
${document.getElementById('fer').value}

4. APLICA√á√ÉO:
${document.getElementById('apl').value}
        `;
        const blob = new Blob([conteudo], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = window.URL.createObjectURL(blob);
        link.download = `EDB_${ref}.txt`;
        link.click();
    }

    function limparCaderno() {
        if(confirm("Isso apagar√° o texto do caderno. Continuar?")) {
            document.querySelectorAll('textarea, input').forEach(i => i.value = "");
        }
    }

    window.onload = carregarHistorico;
</script>
</body>
</html>