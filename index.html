<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDB - Central de Exegese</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --bg: #000000; --card: #161618; --accent: #0A84FF;
            --text: #ffffff; --muted: #8E8E93; --border: #2C2C2E;
            --success: #30D158; --danger: #FF453A;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; }
        header { padding: 20px; border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; text-align: center; }
        nav { position: fixed; bottom: 0; width: 100%; background: var(--card); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; }
        .nav-item { color: var(--muted); text-decoration: none; font-size: 11px; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
        .nav-item span { font-size: 22px; margin-bottom: 4px; }
        .page { display: none; padding: 20px; animation: fadeIn 0.2s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: var(--card); border-radius: 14px; padding: 18px; margin-bottom: 15px; border: 1px solid var(--border); }
        .badge { background: #323234; padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: bold; margin-bottom: 10px; display: inline-block; text-transform: uppercase; }
        h3 { margin: 0; color: var(--accent); font-size: 1.1rem; }
        textarea, input { width: 100%; background: #000; border: 1px solid var(--border); border-radius: 10px; color: #fff; padding: 14px; margin-top: 10px; font-size: 16px; box-sizing: border-box; outline: none; }
        .export-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn { padding: 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-pdf { background: var(--danger); color: white; }
        .btn-txt { background: #323234; color: white; border: 1px solid #48484a; }
        .btn-save { background: var(--accent); color: white; width: 100%; margin-top: 20px; }
        .hist-item { padding: 15px; border-bottom: 1px solid var(--border); display: flex; flex-direction: column; cursor: pointer; transition: 0.2s; }
        .hist-item:active { background: #2c2c2e; }
        .hist-header { display: flex; justify-content: space-between; align-items: center; }
        .hist-date { color: var(--muted); font-size: 11px; }
    </style>
</head>
<body>

<header id="header-title">Caderno de Estudo</header>

<div id="p-caderno" class="page active">
    <div id="pdf-area">
        <input type="text" id="ref" placeholder="ReferÃªncia (ex: Filipenses 4:13)">
        <div class="card" style="border-left: 4px solid var(--accent);"><div class="badge">Passo 1</div><h3>ObservaÃ§Ã£o ğŸ”</h3><textarea id="obs" rows="4"></textarea></div>
        <div class="card" style="border-left: 4px solid #F1C40F;"><div class="badge">Passo 2</div><h3>InterpretaÃ§Ã£o ğŸ’¡</h3><textarea id="int" rows="4"></textarea></div>
        <div class="card" style="border-left: 4px solid #9B59B6;"><div class="badge">Apoio</div><h3>Ferramentas ğŸ› ï¸</h3><textarea id="fer" rows="3"></textarea></div>
        <div class="card" style="border-left: 4px solid var(--success);"><div class="badge">Passo 3</div><h3>AplicaÃ§Ã£o ğŸŒ±</h3><textarea id="apl" rows="4"></textarea></div>
    </div>
    <button class="btn btn-save" onclick="salvarNoHistorico()">ğŸ’¾ Registrar Estudo Completo</button>
    <div class="export-group">
        <button class="btn btn-pdf" onclick="baixarPDF()">ğŸ“„ PDF</button>
        <button class="btn btn-txt" onclick="baixarTXT()">ğŸ“ TXT</button>
    </div>
</div>

<div id="p-teoria" class="page">
    <input type="text" id="search" style="background:#1c1c1e; border:none; margin-bottom:20px;" placeholder="ğŸ” Pesquisar na apostila..." onkeyup="filtrarTeoria()">
    <div id="lista-teoria">
        <div class="card t-item"><div class="badge">Aula 1</div><h3>Eisegese</h3><p style="font-size:14px; color:var(--muted);">Impor sentido pessoal ao texto.</p></div>
        <div class="card t-item"><div class="badge">Aula 2</div><h3>ObservaÃ§Ã£o</h3><p style="font-size:14px; color:var(--muted);">Verbos, repetiÃ§Ãµes e o que Deus revela de Si.</p></div>
    </div>
</div>

<div id="p-check" class="page">
    <h2>Checklist</h2>
    <div class="card">
        <label style="display:flex; gap:10px; padding:12px 0; border-bottom:1px solid var(--border);"><input type="checkbox"> OraÃ§Ã£o inicial</label>
        <label style="display:flex; gap:10px; padding:12px 0; border-bottom:1px solid var(--border);"><input type="checkbox"> AnÃ¡lise de contexto</label>
    </div>
    <button class="btn btn-txt" onclick="limparCaderno()" style="width:100%; color:var(--danger)">ğŸ—‘ï¸ Limpar Campos</button>
</div>

<div id="p-hist" class="page">
    <h2>Estudos Realizados</h2>
    <p style="font-size: 12px; color: var(--muted);">Toque em um estudo para abrir e editar.</p>
    <div id="lista-hist" class="card" style="padding:0;"></div>
</div>

<nav>
    <div class="nav-item active" onclick="switchPage('p-caderno', this, 'Caderno de Estudo')"><span>ğŸ“</span>Caderno</div>
    <div class="nav-item" onclick="switchPage('p-teoria', this, 'Biblioteca')"><span>ğŸ“š</span>Teoria</div>
    <div class="nav-item" onclick="switchPage('p-check', this, 'Checklist')"><span>âœ…</span>Checklist</div>
    <div class="nav-item" onclick="switchPage('p-hist', this, 'HistÃ³rico')"><span>ğŸ•’</span>HistÃ³rico</div>
</nav>

<script>
    function switchPage(id, el, title) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
        document.getElementById('header-title').innerText = title;
    }

    function salvarNoHistorico() {
        const ref = document.getElementById('ref').value || 'Sem tÃ­tulo';
        const dados = {
            ref: ref,
            obs: document.getElementById('obs').value,
            int: document.getElementById('int').value,
            fer: document.getElementById('fer').value,
            apl: document.getElementById('apl').value,
            data: new Date().toLocaleString('pt-BR')
        };
        let hist = JSON.parse(localStorage.getItem('edb_v4_hist') || '[]');
        hist.push(dados);
        localStorage.setItem('edb_v4_hist', JSON.stringify(hist));
        carregarHistorico();
        alert("Estudo salvo com sucesso!");
    }

    function carregarHistorico() {
        const hist = JSON.parse(localStorage.getItem('edb_v4_hist') || '[]');
        const container = document.getElementById('lista-hist');
        container.innerHTML = hist.map((h, index) => `
            <div class="hist-item" onclick="abrirEstudo(${index})">
                <div class="hist-header">
                    <b>${h.ref}</b>
                    <span class="hist-date">${h.data}</span>
                </div>
                <small style="color:var(--muted)">${h.obs.substring(0, 40)}...</small>
            </div>
        `).reverse().join('') || '<p style="padding:20px">Nenhum estudo salvo.</p>';
    }

    function abrirEstudo(index) {
        const hist = JSON.parse(localStorage.getItem('edb_v4_hist') || '[]');
        const estudo = hist[index];
        if(confirm(`Deseja carregar o estudo "${estudo.ref}" no caderno? (Isso substituirÃ¡ o texto atual)`)) {
            document.getElementById('ref').value = estudo.ref;
            document.getElementById('obs').value = estudo.obs;
            document.getElementById('int').value = estudo.int;
            document.getElementById('fer').value = estudo.fer;
            document.getElementById('apl').value = estudo.apl;
            switchPage('p-caderno', document.querySelector('.nav-item'), 'Caderno de Estudo');
        }
    }

    function baixarPDF() {
        const element = document.getElementById('pdf-area');
        const ref = document.getElementById('ref').value || 'estudo';
        html2pdf().set({ margin: 10, filename: `EDB_${ref}.pdf`, html2canvas: { scale: 2, backgroundColor: '#161618' }, jsPDF: { unit: 'mm', format: 'a4' } }).from(element).save();
    }

    function baixarTXT() {
        const ref = document.getElementById('ref').value || 'estudo';
        const txt = `REF: ${ref}\n\n1.OBS:\n${document.getElementById('obs').value}\n\n2.INT:\n${document.getElementById('int').value}\n\n3.FER:\n${document.getElementById('fer').value}\n\n4.APL:\n${document.getElementById('apl').value}`;
        const blob = new Blob([txt], { type: 'text/plain' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `EDB_${ref}.txt`; a.click();
    }

    function limparCaderno() {
        if(confirm("Limpar caderno?")) document.querySelectorAll('textarea, input').forEach(i => i.value = "");
    }

    window.onload = carregarHistorico;
</script>
</body>
</html>